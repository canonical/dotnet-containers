name: dotnet-runtime
base: bare
build-base: devel
version: '8.0'
summary: .NET 8 runtime rock for .NET apps.
description: |
  .NET is a free, cross-platform, open source developer platform for building
  many different types of applications. This image contains the .NET runtime,
  but does not include bash, the .NET SDK nor a package manager.
license: MIT
platforms:
  amd64:
  arm64:

run-user: _daemon_

environment:
  # Configure web servers to bind to port 8080 when present
  ASPNETCORE_URLS: "http://+:8080"
  # Enable detection of running in a container
  DOTNET_RUNNING_IN_CONTAINER: "true"
  # Set the invariant mode since ICU package isn't included
  # (see https://github.com/dotnet/announcements/issues/20)
  DOTNET_SYSTEM_GLOBALIZATION_INVARIANT: "true"
  DOTNET_ROOT: "/usr/lib/dotnet"

services:
  dotnet-runtime:
    override: replace
    startup: enabled
    command: /usr/bin/dotnet [ --info ]
    on-failure: shutdown

parts:
  install-dotnet-runtime:
    plugin: nil
    stage-packages:
      - "base-files_base"
      - "base-files_release-info"
      - "ca-certificates_data"
      - "dotnet-runtime-8.0_libs"
    # workaround because /bin in 24.04 is a symlink and that
    # makes pebble and base-files_base have a conflict
    override-build: |
      craftctl default
      rm ${CRAFT_PART_INSTALL}/bin
